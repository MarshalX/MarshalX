{"componentChunkName":"component---src-templates-post-jsx","path":"/blog/post/generaciya-shemy-sborki-kartiny-fotografii-iz-lego","result":{"data":{"prismicPost":{"id":"Prismic__Post__X4H6aBIAACIAIjDy","uid":"generaciya-shemy-sborki-kartiny-fotografii-iz-lego","first_publication_date":"2020-10-10T20:50:07+0000","last_publication_date":"2020-10-12T11:40:40+0000","data":{"title":{"text":"Генерация схемы сборки картины-фотографии из LEGO"},"description":"Рассказываю о своём опыте генерации инструкции по сборке картины в PDF, даю понять, что в этой задаче нет ничего сложного, так как всё уже готово, но если вы не знаете как сгенерировать схему для вышивания крестиком, раскраску по квадратикам для мобильной игры, пикселизировать фото, то прочитав уйдете с несколькими ссылками и пониманием того, куда стоит копать.","date":"10.10.2020","categories":[{"category":{"document":[{"id":"Prismic__Category__Xm56eREAACMACBYT","uid":"poznavatelno","data":{"name":"Познавательно"}}]}}],"body":[{"__typename":"PrismicPostBodyText","slice_type":"text","id":"Prismic__PostBodyText__Prismic__Post__X4H6aBIAACIAIjDy__body__0","primary":{"text":{"html":"<p>В августе месяце меня внезапно занесло на подработку, помимо основной работы. Задача оказалась для меня новой, но со стороны весьма несложной, а даже интересной.</p><h1>Проект</h1><p>Проект представляет из себя сайт, на котором находится конструктор картины. В нем можно загрузить фотографию, выбрать необходимый размер, подвигать привычные нам ползунки при редактировании фотки и посмотреть на то, как картина будет выглядеть в собранном состоянии. Картина состоит из огромной кучи маленьких деталей <strong>LEGO</strong> (1x1 блок), которые необходимо собрать на доске по схеме, полученной после покупки набора.</p>"}}},{"__typename":"PrismicPostBodyImage","slice_type":"image","id":"Prismic__PostBodyImage__Prismic__Post__X4H6aBIAACIAIjDy__body__1","primary":{"image":{"localFile":{"id":"671025bc-5f91-5c40-a083-d9634150dd23","childImageSharp":{"id":"6c5f84fe-5704-5082-b50e-2b2b262058fa","fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAADN0lEQVQoz11SWUwTURSdD79MjInKhyZqTBQ/NBqNW+IeJYIaF9REVJQfFTBGiIJxoQgqCVJpaRGpVUBaQEprKy0tQ4VSoWUpQqHTzgxdpstIN20pHZi2qHUCLokn9368m3vuue+9AwTnEAgEItEou5x+8cxpBEXDRJgqTlIxh/mG4J/jXwBWq8PlcofCJKwfyU/Zkb13YyObMfszHvj2bYYkwwRB0UiSjFA5M/0/GUGsGIZ7vEHUhOal7Ko6v78g/fTnIV0kEoHHRhx2LBab1Wp6D+zbwyiviEZj1Kx/ZIvVabd/wbAJzOml5dzMStr+8MwejUzodk8kb15dzyqLx+NF+bnHExMObttqs9mmCeLv/gBqdhqNVggad+Jex3BvYdoR7tXkQaXM6cJfZKdpRfxYPN7AqSo4vOnglo1codwTCIYmf78GgFpcBsis18MefwASVmgqi1vLClU1rB4dxGWw2Uxulw5RKFXHDiWlHDvFEYIGI0yEw/PigNFkGx1DETNOkLNOdQvEp48rxLCcP9A/9LKpg80H30k/6REbiyfhvAfrmGVwv5ogI8G5mwNWG+72eHglBb2gXPSC/vBy6rXkfWLmY30XWMlTlFaJ6oRK3O2V9QzxQG3N4/uG0ZFJYnp+b2DcjEV//ODTbmWcPLFsReKKVRsWLV5ez2+aiX1vlPfSX7exm7qo3+S+5Fbx3ouYxRoI/eLzT4UmKTZQV14aImMjytazu3cuWJiwZOlKAFjwtOhRwO9rk0iz7hRxqmvFtZw+Zbuo5pWsma+GMcyJT02FKG2AlnEOsZiHFcL8o/uvXMrISL/yIO82v1nAaRDQCp9k5T5oLb0nrHyu1QyCUqlYIgVVWp/XF5oDkLZ1XTco03S2M5kldSoFV9nWKAYFza3stwJRp5ZRUc1jMRRypbJD1QF2Um4ZHNBhmN3j/Yq7fUDq5jW3UpMF1Sx5T0/LJzX9Te2FnOL0u4+aPkj8boekpbmcztT0D72uF92gMUveNJgQ2GpzYvYJk8UBPMvLvL57febOtR/fcv0TLny8W6MD27s7EaMBMgyjplEzDFktKOWtAb3po7rPZKT8jJstjjHY8guaqVv/fmFwFQAAAABJRU5ErkJggg==","aspectRatio":1.431980906921241,"src":"/static/dcac55231c68e31c051b3f801014ed7f/92346/e5b46e7c-6d5c-4655-8d95-7691a2f86bf6_Picture%2B1.png","srcSet":"/static/dcac55231c68e31c051b3f801014ed7f/5a635/e5b46e7c-6d5c-4655-8d95-7691a2f86bf6_Picture%2B1.png 162w,\n/static/dcac55231c68e31c051b3f801014ed7f/ebbd7/e5b46e7c-6d5c-4655-8d95-7691a2f86bf6_Picture%2B1.png 322w,\n/static/dcac55231c68e31c051b3f801014ed7f/92346/e5b46e7c-6d5c-4655-8d95-7691a2f86bf6_Picture%2B1.png 644w,\n/static/dcac55231c68e31c051b3f801014ed7f/9c260/e5b46e7c-6d5c-4655-8d95-7691a2f86bf6_Picture%2B1.png 967w,\n/static/dcac55231c68e31c051b3f801014ed7f/54991/e5b46e7c-6d5c-4655-8d95-7691a2f86bf6_Picture%2B1.png 1200w","sizes":"(max-width: 644px) 100vw, 644px","presentationWidth":644}}}}}},{"__typename":"PrismicPostBodyText","slice_type":"text","id":"Prismic__PostBodyText__Prismic__Post__X4H6aBIAACIAIjDy__body__2","primary":{"text":{"html":"<h1>Задача</h1><p>Проект был в состоянии демки, о чем свидетельствовала генерация PDF, которая просто показывала возможность вывода всего того, что надо без какого-либо выравнивания, стилей. Мне предстояло разработать генератор схемы по предоставленному макету (на фотографии выше листы именно с ним), переписать метод превью изображения на использования новых элементов.</p><h1>Теория (как это работает в общем случае)</h1><p>Максимально коротко объясняю, но давайте договоримся, что вы будете переходить по оставленным ссылкам после абзацев и смотреть хотя бы на изображения, чтобы понимать о чем идёт речь. </p><p>Для оптимизации занимаемого место в памяти придумали не хранить в каждом пикселе его цвет, представленный в каком-либо виде, например, в <em>RGB</em>, а решили создать матрицу, так называемую палитру цветов изображения, а в пикселях ссылаться на элемент в палитре. </p><p><a  href=\"https://en.wikipedia.org/wiki/Indexed_color\">https://en.wikipedia.org/wiki/Indexed_color</a></p><p>Для решения нашей задачи необходимо получить в конечном счете изображение, которое имеет намного меньше пикселей (блоков LEGO) и, внимание, состоит из определенного перечня цветов! Никто на заводе не будет штамповать LEGO под определённый заказ пользователя.</p><p>Если с количеством пикселей думать не надо – изменяем размер изображения да на такой, чтобы его потом порезать на тайлы (фрагменты), при объединении которых получилась бы большая картина, то вот с цветами надо что-то придумать.</p><p>Я сказал придумать? Бросьте, за нас уже давно всё придумали. То, что нам надо, называется квантование цветов. Суть проста: максимально уменьшаем количество используемых цветов в палитре изображения так, чтобы визуально было похоже на оригинал. </p><p><a  href=\"https://en.wikipedia.org/wiki/Color_quantization\">https://en.wikipedia.org/wiki/Color_quantization</a></p><p>Уменьшив количество цветов, получаем неприятную картинку для глаза. слишком резкие перехода между цветами, пиксели сильно выделяются и это выглядит совсем не как оригинал. В рамках проекта по пикселизации фотографии этого достаточно так как именно то, что нам надо, но пробегусь чуть дальше, ибо это затрагивается библиотеками под капотом. </p><p>Для исправления положения с резкими переходами используют дизеринг. Как и в способах квантования, так и в дизеринге есть свои алгоритмы, которым десятки лет. Один из них очень популярный алгоритм – алгоритм Флойда – Стейнберга. Его реализация занимает считанные строки кода, но даже и этого вам не надо делать! Все есть в библиотеках для работы с изображениями. </p><p><a  href=\"https://en.wikipedia.org/wiki/Floyd–Steinberg_dithering\">https://en.wikipedia.org/wiki/Floyd–Steinberg_dithering</a></p><p>Для тех, кто решил не переходить по ссылкам выше продублирую то, о чем говорил. Оригинальная фотка, квантование цветов и дизеринг с квантованием.</p>"}}},{"__typename":"PrismicPostBodyImage","slice_type":"image","id":"Prismic__PostBodyImage__Prismic__Post__X4H6aBIAACIAIjDy__body__3","primary":{"image":{"localFile":{"id":"69ed4ce1-89cc-5c2f-a37d-5e458626b3ea","childImageSharp":{"id":"76e2a517-d2ec-5116-b0f5-531248d9ad9e","fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAFABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAIDBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAdeIWA//xAAXEAEBAQEAAAAAAAAAAAAAAAABABMD/9oACAEBAAEFAsizI5hf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGRAAAgMBAAAAAAAAAAAAAAAAATEAESEQ/9oACAEBAAY/Ahpw3GXb5//EABkQAAMAAwAAAAAAAAAAAAAAAAABESExYf/aAAgBAQABPyGajqBLgi1t13LP/9oADAMBAAIAAwAAABADz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABsQAQACAwEBAAAAAAAAAAAAAAERIQAxUXHh/9oACAEBAAE/EEgKizt49M3oHeqarytYTFmlIx8z/9k=","aspectRatio":4.285714285714286,"src":"/static/58cd995a0693d010780f5d11e05bffca/3617a/4502d407-0fc5-4c51-9678-c63e7eb361e7_cats.jpg","srcSet":"/static/58cd995a0693d010780f5d11e05bffca/42007/4502d407-0fc5-4c51-9678-c63e7eb361e7_cats.jpg 484w,\n/static/58cd995a0693d010780f5d11e05bffca/0a4bb/4502d407-0fc5-4c51-9678-c63e7eb361e7_cats.jpg 964w,\n/static/58cd995a0693d010780f5d11e05bffca/3617a/4502d407-0fc5-4c51-9678-c63e7eb361e7_cats.jpg 1200w","sizes":"(max-width: 1200px) 100vw, 1200px","presentationWidth":1200}}}}}},{"__typename":"PrismicPostBodyText","slice_type":"text","id":"Prismic__PostBodyText__Prismic__Post__X4H6aBIAACIAIjDy__body__4","primary":{"text":{"html":"<h1>Как это работает в проекте</h1><p>Я уже упомянул, что количество цветов LEGO ограничено. Их что-то около 40 совершенно разнообразных. На проекте используется библиотека <em>Pillow</em>. Через которую практически всё делается с помощью одной строчки кода. Так к изображению применяется изменение размера, <em>color</em>, <em>sharpness</em>, <em>contrast</em>, <em>brightness</em>. <em>Hue</em> и <em>saturation</em> и прочие свистелки-перделки. В конечном итоге полностью заменяется палитра.</p><p>Помимо этого, конечно, происходит конвертация изображений к нужным форматам. Например, перегоняется из <em>P</em> в <em>RGBA</em>, потом убирается альфа и остается RGB. На выходе имеем изображением с 8-битным цветом. Следовательно, нам нужна палитра из 256 цветов, а мы помним, что уникальных цветов у нас ~40. Что делать? Нуу, например, удлинить палитру просто продолжив последовательность, пока не наберем нужное количество! Честно, я не могу это объяснить, данный код был написан прошлым разработчиком из известной в Беларуси, да и не только, компании) Передаю привет Игорю. </p><p>Продолжив последовательность из цветов создается новое пустое изображение, которому устанавливается эта палитра. Выглядит это чудо следующим образом:</p>"}}},{"__typename":"PrismicPostBodyImage","slice_type":"image","id":"Prismic__PostBodyImage__Prismic__Post__X4H6aBIAACIAIjDy__body__5","primary":{"image":{"localFile":{"id":"8ff0bfb4-1302-500e-8e4d-a6152448436c","childImageSharp":{"id":"c8e471ce-2d0f-5715-90c9-ea20940b367f","fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAWABQDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAT/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAABgEAAAf/EABQQAQAAAAAAAAAAAAAAAAAAADD/2gAIAQEAAQUCH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABQQAQAAAAAAAAAAAAAAAAAAADD/2gAIAQEABj8CH//EABoQAAICAwAAAAAAAAAAAAAAAAABIUEQMZH/2gAIAQEAAT8he5KODKJHDKx//9oADAMBAAIAAwAAABAs98L/xAAXEQEAAwAAAAAAAAAAAAAAAAAAEBFB/9oACAEDAQE/EIxb/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPxAf/8QAHRAAAgMAAgMAAAAAAAAAAAAAAREAITFRYUGBkf/aAAgBAQABPxBUCPuEYB964DVjo6hEIWuQKhWMfiCmn5DphRxQ5gQGm+J//9k=","aspectRatio":0.9009009009009009,"src":"/static/7d6d98e8c6c8f6c2d1e2d8409eca89c6/b4fce/1b6840dd-e369-4599-8341-81611f50052a_palitra.jpg","srcSet":"/static/7d6d98e8c6c8f6c2d1e2d8409eca89c6/42007/1b6840dd-e369-4599-8341-81611f50052a_palitra.jpg 102w,\n/static/7d6d98e8c6c8f6c2d1e2d8409eca89c6/0a4bb/1b6840dd-e369-4599-8341-81611f50052a_palitra.jpg 203w,\n/static/7d6d98e8c6c8f6c2d1e2d8409eca89c6/b4fce/1b6840dd-e369-4599-8341-81611f50052a_palitra.jpg 405w,\n/static/7d6d98e8c6c8f6c2d1e2d8409eca89c6/fab03/1b6840dd-e369-4599-8341-81611f50052a_palitra.jpg 608w,\n/static/7d6d98e8c6c8f6c2d1e2d8409eca89c6/6a48d/1b6840dd-e369-4599-8341-81611f50052a_palitra.jpg 811w,\n/static/7d6d98e8c6c8f6c2d1e2d8409eca89c6/cad2c/1b6840dd-e369-4599-8341-81611f50052a_palitra.jpg 1200w","sizes":"(max-width: 405px) 100vw, 405px","presentationWidth":405}}}}}},{"__typename":"PrismicPostBodyText","slice_type":"text","id":"Prismic__PostBodyText__Prismic__Post__X4H6aBIAACIAIjDy__body__6","primary":{"text":{"html":"<p>А дальше дело за подкапотной <em>Pillow</em>! Метод <code class=\"language-python\"><span class=\"token punctuation\">.</span>convert<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code> вызывается у исходного изображения, в котором надо изменить палитру. Принимает в аргументах режим (мод), в нашем случае это <strong>8bit</strong> – мод <strong>P</strong>, алгоритм дизеринга (<code class=\"language-python\"><span class=\"token boolean\">None</span></code> – не применять) и наше изображение с палитрой. Вот так просто. </p><p>В документации расписали какой и когда алгоритм используется – <a  href=\"https://pillow.readthedocs.io/en/stable/reference/Image.html#PIL.Image.Image.convert\">PIL.Image.Image.convert</a></p><h2>Результат пикселизации</h2><p>Ниже исходное изображение и результаты в размере 512x512 и 128x128.</p>"}}},{"__typename":"PrismicPostBodyImage","slice_type":"image","id":"Prismic__PostBodyImage__Prismic__Post__X4H6aBIAACIAIjDy__body__7","primary":{"image":{"localFile":{"id":"219f5d26-93ab-57e1-a892-68323a9f539c","childImageSharp":{"id":"02e3fe72-f490-5334-a732-b3efa7574535","fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAQF/8QAFwEAAwEAAAAAAAAAAAAAAAAAAQIEA//aAAwDAQACEAMQAAABz6bptpcpqHW2cM9YC//EABoQAAMBAQEBAAAAAAAAAAAAAAECEQMAEiL/2gAIAQEAAQUCTOnVUKw9PCAitn9E1c0CNe//xAAaEQABBQEAAAAAAAAAAAAAAAAAAQIQESET/9oACAEDAQE/AUdenUvI/8QAGREAAQUAAAAAAAAAAAAAAAAAAAECEBES/9oACAECAQE/AXLRmf/EAB0QAAICAQUAAAAAAAAAAAAAAAABEBEiAiExYZH/2gAIAQEABj8CMdFNdw3QsfDgo2j/xAAdEAADAAICAwAAAAAAAAAAAAAAARExUSFBYZGx/9oACAEBAAE/IYFXH0it0DUWtwXofQkzPAdUYYzoy0z2Uf/aAAwDAQACAAMAAAAQUxd9/8QAFxEBAQEBAAAAAAAAAAAAAAAAAQAQEf/aAAgBAwEBPxBiBg8hDBz/xAAYEQEAAwEAAAAAAAAAAAAAAAABEBEhQf/aAAgBAgEBPxAd12oIR//EABwQAQEAAgMBAQAAAAAAAAAAAAERACExUWFxQf/aAAgBAQABPxBrp62fF/LgIpjQI+c7cUkzm4hZYeXFPl0C+n5goovWMN1xDrJmYsTsxTmZ/9k=","aspectRatio":1,"src":"/static/80093fb9fd1696ce9df1f3625e2518b9/b4fce/94621dd0-f398-4754-afd1-d30ead7c33b8_block.jpg","srcSet":"/static/80093fb9fd1696ce9df1f3625e2518b9/42007/94621dd0-f398-4754-afd1-d30ead7c33b8_block.jpg 113w,\n/static/80093fb9fd1696ce9df1f3625e2518b9/0a4bb/94621dd0-f398-4754-afd1-d30ead7c33b8_block.jpg 225w,\n/static/80093fb9fd1696ce9df1f3625e2518b9/b4fce/94621dd0-f398-4754-afd1-d30ead7c33b8_block.jpg 450w,\n/static/80093fb9fd1696ce9df1f3625e2518b9/fab03/94621dd0-f398-4754-afd1-d30ead7c33b8_block.jpg 675w,\n/static/80093fb9fd1696ce9df1f3625e2518b9/6a48d/94621dd0-f398-4754-afd1-d30ead7c33b8_block.jpg 900w,\n/static/80093fb9fd1696ce9df1f3625e2518b9/29028/94621dd0-f398-4754-afd1-d30ead7c33b8_block.jpg 1200w","sizes":"(max-width: 450px) 100vw, 450px","presentationWidth":450}}}}}},{"__typename":"PrismicPostBodyImage","slice_type":"image","id":"Prismic__PostBodyImage__Prismic__Post__X4H6aBIAACIAIjDy__body__8","primary":{"image":{"localFile":{"id":"08b9aae6-23f9-5015-8177-a8c782a4bfa9","childImageSharp":{"id":"3f5704c8-8c58-5d98-887b-1c997a7fec29","fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEC0lEQVQ4y2OQNk/HRLJWmZImKaKGaRKmWWKGyTKWmTKWGZjKGLBpzhDVT9LwLM5YvCN13i6rqDopkxRxoxQZiwxCmi0y5cwSbQuaOm5fP/r/86n/7xZ9fhm7dqeOe664cSqafiTNFhlAt0lpxxiUTE58+DL17tPiJ8+WfHtZ8eR5xqt3EZNXiOklAt2PqhlmmIxpsrRpqkjYBLO5G/yiInz6+wy33LJYc9Fq003nrsUR6elyjvnSJinSSJYzyJokywCFzNOFvRqYYxfwdpzy3XtRTENd39PVbfV5nqCJbAGT5eLajMNDlVp38zlVyxknSpulAcMFpFnUpYIraiZL+mrG3K0MpQc0qxaZ9mzLv/Ywau8xv/2Pbfu2mhf22u65kXX5oeqM0wypGwVCeqUtM0FWmqUxMOZuZijayZC3jSlvs+ri8zXxEWkFNQ5LTmv27pDp3a3ZsEK8ZLVS2dK05FTTnnXstQcYcrYyZ60T8GuXsshgYCzYxpCzhTl3i/bOuyUrVu4riLx9bXfanvMMnhPEirbLZi8U7jko17I52S+8oDRHfeMN5rwtDPk7GAp3sqSuYADqZMjarLnmktelB0smtL3fveHKx6feF55YbLjmsv+h550PiQ+eOM5aE983tWN6m8/mferrrzNkbGTM38pQsIOBo2Kn8barzjdeBu49t39q19fHVyuPXFKbdjT07vPY6889lq/p7i/YsT5r0fSIvE3bwvedsrvwlKtyJ0P2Foa8rQzG26953XzmcPmZ36HLx9fNW3DlqtXeO6p1a3RnnY16+Clmckd6ksvyma6LJwQG9883PvjQ++YzmWnHGTI2MeZvY3C99Nj5/COXi49dLj7J2HMgacV68/lXLVZf48zbKNd3M37ShMRkh+Di9PjyhMi08Mj9J51vvtLfeJkhezMosJwvPAbrfOx88Ynjpcd+6/ayh8+Urttnsuwqo2N9fo7twtXx/PGVnEYGuqFB4duWO938YHvkNkvuFoa0jQwQna4XH9udf5xz7/GcG8e1WrcxhM/Vn3PNavpZnWD/rOpAmwR/ZU933oBSq6UL3G+8dbnwUHv1RZGugzDNlx7bnnuU8+Dptf+fkvZcZYhcwJm0iLvkkJh/uZm/h1txnl5S/oSLV1POggLM9eIjjxvP3K8+gWoGIqcLjz0vPZ77/VXZlfsM6WskHYo5nLLZPewUHKN43Gt0KiKmfnrie/2F04VHQGc6XwAFE0IzyNvnHzldfmK+6QZL+npRqzJRc3f2KFWJ5F7dBTs1+6scztx3uvgEWT2KZpcLj10vP7HceU131TnlqtXiad1cyVWivQedLz1xv/LcFVUnhmaI/688db/+zPXSI8cLz2yOPXY6+wBoqPOFh5gqAdWQNJCWMtpwAAAAAElFTkSuQmCC","aspectRatio":1,"src":"/static/8388b7acb13bbc28f518e39bacf2c881/92346/0bd92d77-226d-435e-b157-3d78acc1934b_17e3c3fc0b3311eb9b09a0c589894e37.png","srcSet":"/static/8388b7acb13bbc28f518e39bacf2c881/5a635/0bd92d77-226d-435e-b157-3d78acc1934b_17e3c3fc0b3311eb9b09a0c589894e37.png 113w,\n/static/8388b7acb13bbc28f518e39bacf2c881/ebbd7/0bd92d77-226d-435e-b157-3d78acc1934b_17e3c3fc0b3311eb9b09a0c589894e37.png 225w,\n/static/8388b7acb13bbc28f518e39bacf2c881/92346/0bd92d77-226d-435e-b157-3d78acc1934b_17e3c3fc0b3311eb9b09a0c589894e37.png 450w,\n/static/8388b7acb13bbc28f518e39bacf2c881/9c260/0bd92d77-226d-435e-b157-3d78acc1934b_17e3c3fc0b3311eb9b09a0c589894e37.png 675w,\n/static/8388b7acb13bbc28f518e39bacf2c881/5ee7d/0bd92d77-226d-435e-b157-3d78acc1934b_17e3c3fc0b3311eb9b09a0c589894e37.png 900w,\n/static/8388b7acb13bbc28f518e39bacf2c881/3c346/0bd92d77-226d-435e-b157-3d78acc1934b_17e3c3fc0b3311eb9b09a0c589894e37.png 1200w","sizes":"(max-width: 450px) 100vw, 450px","presentationWidth":450}}}}}},{"__typename":"PrismicPostBodyImage","slice_type":"image","id":"Prismic__PostBodyImage__Prismic__Post__X4H6aBIAACIAIjDy__body__9","primary":{"image":{"localFile":{"id":"1e8d284f-c152-5919-a38b-aec25fa6e99e","childImageSharp":{"id":"8ed7f640-2084-531e-8001-768ade3ce5a2","fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAAECUlEQVQ4y2OQNk9HRxbpstaZkiapooapkmZZYkbJ0laZMpYZmCoZsGg2SxfVS9JwK8pauj1j0R7rqEYZkxRxoxQZiwy8mi3SpcwzFG3TnEqa225dPfL/86n/7xd9fpm6ea+eR56YcSqafiTNFhlAt0lqxRhUzUh4+Dz+1uOix8+W/XxZ/+pF/vuP0VPXiuolyFhmomqGGSZjkixlliYSMdF2yTa/6PCACRPMttw2W3XOatMNz+4lMTk58o4FUiYp0kiWM8iaJAO9BGSJeDcyxy3i7znjv+eimIaOrpeT2+oLnCFT2PwnKyS2WkWHqLXvEnCokDNJlDZLkzYHGcEg6lrFFT2TNX0lY+5WhuIDujWLbHq35l19HLnnmP+hp3aTdxtmdVnvu55/44XatJMMKev5Q/ulLDJBVpqlMTDmbWEo3MmQt405f4vKgjPVCVH5+TWui09rd29TmnpAv3mlZOkqtfJl2Wnpxu2rOeoOMORsZc5cJ+DXIW2RycBYsI0hZwtz7madXXfLV6/ZWxzx4OrOzJ3nGLwmSRRtlclaINp7UKlte6pfeHF5tubGGyy5mxnytwPtY0ldycCYs4Uhc5PmqoueFx8u6W99t3fdpS/PAq48t9xwzXn/Q49b72PvPnSYvjZ1wsyumR2+G/apr7vGkL6RMX8bQ8EOBq6qXabbrzldfxl04NKBGf1fH12tOnJZa+bJkLvP42+88Fq2euLE/INbcpZNiyzcuDPqwCnbc084y3cAHcuQt5XBZMd175vPHC499T9y9cT6BcuuXXXcd0+1fq3BrLPRD79EzezLTXbZssRnxczQqMkLzQ8/ACqWmXKMIWMTyHLXy0+czz9yufjY+cLjrH2HstdsMZ9zxWLNdc78TfI91+MnTkxJcYwoz8pszIjPjQ0/cMr55ivDTZcZsjaDAsv5AkgnRLPztafBm4+whc+Wqd9nsuwKk3N9Qa79wtUJIgk1vCZG2qFBQdtWON/6YH3oFnPWZoa0TQwQna4XH9udf5x17/HCe6d1W7cxhM0xmnfDdvYF3SD/nAY/txR/ZU8v/pAK8+UL3a6/dbnwUHfdJZGugzDNlx7bnnuUff/Jlf8fMvZcZohaxJW8hK/skJh/qVWIn1t5kUFy4eTL15MunLW78NT14iPP68/crzyFagYipwuPPS4+mvXtZfWVe4yZG8QdSzld8tl9HJWdo3g963VKQqZ9fOx3/bnThUeuID+CPIvQDPG24+UnlltvsWVuFLYqFzH3FIrTkE6ZaLB4j+akSrszd50vPkFWj6LZ5cJjt8tPbHZf1197QbVmnURqD19itXjvAedLzzyuvXJF1YmhGeL/K0/drz9zBXnkuc2xx87nHrpceOR84SGmSgDdeDe7yFOzngAAAABJRU5ErkJggg==","aspectRatio":1,"src":"/static/48f25dfac3ed2609bda2f297a5ffd465/92346/0a4853b7-2cef-406f-8bca-6cbed7b59b9a_dde3a6ae0b3211eb9b09a0c589894e37.png","srcSet":"/static/48f25dfac3ed2609bda2f297a5ffd465/5a635/0a4853b7-2cef-406f-8bca-6cbed7b59b9a_dde3a6ae0b3211eb9b09a0c589894e37.png 113w,\n/static/48f25dfac3ed2609bda2f297a5ffd465/ebbd7/0a4853b7-2cef-406f-8bca-6cbed7b59b9a_dde3a6ae0b3211eb9b09a0c589894e37.png 225w,\n/static/48f25dfac3ed2609bda2f297a5ffd465/92346/0a4853b7-2cef-406f-8bca-6cbed7b59b9a_dde3a6ae0b3211eb9b09a0c589894e37.png 450w,\n/static/48f25dfac3ed2609bda2f297a5ffd465/9c260/0a4853b7-2cef-406f-8bca-6cbed7b59b9a_dde3a6ae0b3211eb9b09a0c589894e37.png 675w,\n/static/48f25dfac3ed2609bda2f297a5ffd465/5ee7d/0a4853b7-2cef-406f-8bca-6cbed7b59b9a_dde3a6ae0b3211eb9b09a0c589894e37.png 900w,\n/static/48f25dfac3ed2609bda2f297a5ffd465/3c346/0a4853b7-2cef-406f-8bca-6cbed7b59b9a_dde3a6ae0b3211eb9b09a0c589894e37.png 1200w","sizes":"(max-width: 450px) 100vw, 450px","presentationWidth":450}}}}}},{"__typename":"PrismicPostBodyText","slice_type":"text","id":"Prismic__PostBodyText__Prismic__Post__X4H6aBIAACIAIjDy__body__10","primary":{"text":{"html":"<h2>Генерация превью</h2><p>Дело осталось за малым – рендер. У нас есть изображение достаточно маленьких размеров, например, 256 на 256 пикселей. Оно, в свою очередь, в PDF будет состоять из тайлов, например, 32x32. Для рендера превью просто проходимся по каждому пикселю изображения, маппим цвет пикселя с картиной блока LEGO и собираем так целое изображение, состоящее из 256 изображений блоков. </p>"}}},{"__typename":"PrismicPostBodyImage","slice_type":"image","id":"Prismic__PostBodyImage__Prismic__Post__X4H6aBIAACIAIjDy__body__11","primary":{"image":{"localFile":{"id":"e95cb5cd-5da7-55b5-85be-4d878ed9c040","childImageSharp":{"id":"ae9b3e9d-3a14-5761-b47f-1eca2ae5f86e","fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEXElEQVQ4y12Qe0xTZxiHTxYCi3FzmhgTLtIyYKSJYGAKvXBre04BGThoi1DAFlqKUq7l0gkEA0gcsOq4DAXHQAQJVFBAyh1hzAE9pVAQx+18LUVuNbiLfyzLEnZKnWRLni9fcvJ73u/3HohAFROoCf/jU98rp72EBGqiPUVscy7OwSeRSDPHxAeICDRTDDJ9ovzHtKck2LjzSazk7JaenA6lT3Se3bk4O8+4dz7l3zxFBJlnHJrUREcaXyi/0/GrbmR/e3h/s/tPo7StlwSLT3uJcJ94ECPSTCOgQ5MmdvBOtHPjkTPlha+Ndze2G4yb9Xubt7d02au7USX1Nh6X8QCRavbF5tpigmme2IEcTyCLrNmFcG1rVLwgtaY+uHOF1v5zUPcLTsXTBInEmZ6EBwjvlhfhQA5koYNXHJEismXlHImsIpXPS8aXPej0cEF0xP1fjvPqjnFqLuY3c6WproV9J+lZjl4CIlloehKvbcuUnuBVHeXfsxC3O99aDC8eYpU+LVnQFw0Mikb3vEuHzkbKgpqxrIUd79YXH8S3n2R/be9z1cFTQKAIoaMShUVa14mM/s+rtCHPQH58VHJGQbhi3ufeMKmk57PSDmLxY4+Kx6KsXM6D0TN3Zy0lXR9daT0VdtMe3/nDlC7X66ovFYbA6deyWsX4VwKwNJw+tmAXUeuS1e+W0up0R+2S1yS4JMguzgue2XIq+8ni6hPLjN6PBT9ArDoQNrCFzK0HPltpLb/15scn6KvlmI7fuC067oMdnvZ3qW7Nr7o5+duK7x7KA3pGLqA7Z0tRK0mnVVoPFDy1wZxZZcy9Cu0ZG7hd8GZFKxuf97s5lzy6lblgCKirl5em9nflPWyIk49O8EbH/ebWOYM7PmVLlpIOiKnGEBVG1xguDqon2qob51UhTXrPa8ovanTps3+kVctl0qC2Km5bJftayxAysQ7PYMgUiOzac7k+CSGoDkYBosYYqD5d2V840h37yBhcvU7IVrp/o8+paRFIQ+Nyk5JyYjKz+ILhST/NBqxeDZzUcxqNEKIGMIqx1MBnGvCXQapy9JPYBo+i5yz54jFGZooEblLkkxJvnDrvTo0OuaBoYWh3kOk1WI1xO40QrAYICugqjK3Vdb7Vy6fG3Ip6LGLqaVXLSPmsL58vy74UIOSQOZGECBmr+XtEuwnjMl52EryXQbgWtL81TOwbo5WaI9w668v1x9P6HNlp3MjgUJmMnnujckbzaHeBt6j3n8ZwhaFeM9cGrBksdhFU7K5P7m/KNEtWsY3OjEybgLSTMJnEYtuG5nnnJSj/MnT/vS0FOr8DGVZhkOkygQXOAN4CEK4Cdh+wlvQSqRn25wNsAlzJOc3U+wP06vLYl4awOfy/mvOAiWKm2ubmTBT4qzBfFJD7Xnp0as8UKFxSK51Sy+AOLEi7wVDr/FWm7ZDDPAbh5z2IGQ1ANDocWG1gPd9gomtM1RqMg2I4TJUpiXdmqLB/AOZcVD9B+0N6AAAAAElFTkSuQmCC","aspectRatio":1,"src":"/static/df16408c560af078271aa2f7eed44450/92346/5fdb8613-3a28-4b0b-b293-5952262c52cb_preview.png","srcSet":"/static/df16408c560af078271aa2f7eed44450/5a635/5fdb8613-3a28-4b0b-b293-5952262c52cb_preview.png 113w,\n/static/df16408c560af078271aa2f7eed44450/ebbd7/5fdb8613-3a28-4b0b-b293-5952262c52cb_preview.png 225w,\n/static/df16408c560af078271aa2f7eed44450/92346/5fdb8613-3a28-4b0b-b293-5952262c52cb_preview.png 450w,\n/static/df16408c560af078271aa2f7eed44450/9c260/5fdb8613-3a28-4b0b-b293-5952262c52cb_preview.png 675w,\n/static/df16408c560af078271aa2f7eed44450/5ee7d/5fdb8613-3a28-4b0b-b293-5952262c52cb_preview.png 900w,\n/static/df16408c560af078271aa2f7eed44450/3c346/5fdb8613-3a28-4b0b-b293-5952262c52cb_preview.png 1200w","sizes":"(max-width: 450px) 100vw, 450px","presentationWidth":450}}}}}},{"__typename":"PrismicPostBodyText","slice_type":"text","id":"Prismic__PostBodyText__Prismic__Post__X4H6aBIAACIAIjDy__body__12","primary":{"text":{"html":"<h2>Генерация PDF</h2><p>В самом начале я говорил, что генерация PDF уже была, но, увы, та библиотека, на которой оно работало, мне не подходила. От меня просили векторную графику, чтобы при увеличении не терялось качество, но составлять надо было схемы, конечно же, из иконок, которые обозначают цвет. Поэтому я начал копать в сторону использования SVG в библиотеке <em>reportlab</em>. С помощью неё и сгенерировал всё. Помимо векторной графики необходима поддержка разных размеров и форматов. Так, например, PDF должна быть в формате А3 и А4, цветном и чёрно-белом режиме. В чёрно-белом присутствовали только изображения (иконки) цветов, а в цветном у них был фон. Ко всему этому мы имеем кучу размеров картин, количества тайлов и их расположения! Всё это должно было быть мега резиновым! Таким и вышло. Практически все размеры высчитываются динамически при генерации, где-то используются коэффициенты. Код от такого преображается в худшую сторону. Везде сплошные подсчеты отступов, ширин и высот, координат размещения, границ объектов.</p><p>Первая страница содержит превью картины и правильное расположение тайлов для сборки. Дальше идет N количество страниц, равное количеству тайлов. Под каждой таблицей есть количество необходимых LEGO-блоков, а на первой странице общее количество.</p><p>Примеры сетки:</p>"}}},{"__typename":"PrismicPostBodyImage","slice_type":"image","id":"Prismic__PostBodyImage__Prismic__Post__X4H6aBIAACIAIjDy__body__13","primary":{"image":{"localFile":{"id":"43ac8067-9bae-5562-a38f-b73cffe48aa8","childImageSharp":{"id":"f6e2d289-f162-59ce-bfcd-6d1e2c6be4f9","fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAIAAABPIytRAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEqElEQVQ4y22UaU8bVxSG/RuqfuqHVlWrpFKbqFHalChLRdPiBggFpWCyYNI0uEBYSgpCkLIFUkpoWJqF1RgIEMApghCCY4zBBhsvePd4G9vYY4PHCx7M5g3jXoNA6vLM3KuZq3POO3Ov3oMLh8O7u7tgxjxraq1mw7NhtVhWV1chFWRcWnI5UZfLqdNoTQYD5lkHF4athUKh8B44MPZfDAaDgM8VCoWQShMMBiG1SqOE9HpYrdFQqS9YrBmJRGLQarQGw6EeLnyA3+cPBAI+n8+GRgDiK1aryWRC7Q5Yr8cwtxtzb29teX2+fygfsl8PzKCE3+/fCe2AOPAV+yvh/4DbjwaEDgArTqdTLpdDEKRUKsGDQqEAySBmJ1IttB//b+VDgkH/Gtga96rHsxbZpo01IPE/yqDGg4cNv5Q3VjY+L3s4UPeop+huRWktpbL+WSNlsr65vaTij3sNgyW13fWtw2WV1cX326qanhfWkDlCKJJ8IenW258kfng+473TN07HZrz/cfRJYmly61Apa6GC2k9s7yB0UE8k5p/CZx47m/TOydSj0ZlvHSN0DNBAcji9oPF4TE5UUtFniaXx2a3fNtDTO5+Rast/oguKxqXXKNM3KOO36h9eLibj02pO4LOiEn4++mVG38hMRPl6+eAxYvsXWYOniifSHjMKiu5nd75MqCV/1zxJaJ7+NL3hXMlA5oMnN9tnYu6+Pp7a9PnV3989l9lNncKBfchv4eJ/pV3pEeRN8ugDneqhp90ScUov5wcyJ2+UnzXGI3W9Lr9X9aS/J3tcmNjATqxiRheNjrC1EeUUUv7FR703FUj1JHPsad3l3IK0YW5yz9wdEUKorrt6LXa4t4DSWVDT2xefdTtpkB5fPR2VN/pi3hQ5qpyxqdiXrBS2gsAUl00zL1W0nC4eiamb/fo3NjG3pKgwjlCYjb+anJaXl9bVncAUxZHnPkof7JuGI8kVSnMKS06ckyfPyv/Uw0MmCF88EnWLcrH0r+/v1KWQUuJIuRduk2rpM7ksbipbmT4njxsVjOttkX/O5au+ogniGCI8XUhkSX9ckES3sI9cbz6Czz6TR/qAWHKmaezsk0c5IugKW/7NG8Elhug8jT9iRiPKr5ZdbQZbj9lOXkKHEXuXfqVFbe1QWTsVyHPI0iJDKBZnF+LuM6L9JnubfoVssD3WWuXYBm4nHFZj68BBSjm8bDSarQ79Erq9jnm8mxbEqNQpdrzb6y6nBda57SjmsK/t3Rhq821t4ba93rYhqgJSTAgRjkg5J+BNzc/rjPCsgC2TCxgMKrJshzSaV5M0Do+/KJEIxRIw84SLqN2O83m9HDrdZEasKpnZYJRJuRLxrB118rlcl8Pmca7YHQ4Y1tFoNDabDRym3EMmk7lcLtxuyIfZ3iyZzas6LWqyqBG5zqpYRm08SGDW67UK6cbmJkhmMpkcDgc0E8UeUqkU2Ba3G/Su6ybcbpdq0WK1uPye5Q10aXXd4dzSmGFEyOL7A36dTsdgMLhcruwAsVjscDhwQZ9fx+QB025t+gIB0DSA34OgM4RDAeAZ4HxwHAiCLCwsqFQqwwEwDGMY9jd99OF0MCjW6wAAAABJRU5ErkJggg==","aspectRatio":0.9259259259259259,"src":"/static/9e9c3620465f1b8c591011737a5ffb4a/92346/4c52cd5c-365b-45d9-aa9e-ff3cd1af982c_Picture%2B4.png","srcSet":"/static/9e9c3620465f1b8c591011737a5ffb4a/5a635/4c52cd5c-365b-45d9-aa9e-ff3cd1af982c_Picture%2B4.png 105w,\n/static/9e9c3620465f1b8c591011737a5ffb4a/ebbd7/4c52cd5c-365b-45d9-aa9e-ff3cd1af982c_Picture%2B4.png 208w,\n/static/9e9c3620465f1b8c591011737a5ffb4a/92346/4c52cd5c-365b-45d9-aa9e-ff3cd1af982c_Picture%2B4.png 417w,\n/static/9e9c3620465f1b8c591011737a5ffb4a/9c260/4c52cd5c-365b-45d9-aa9e-ff3cd1af982c_Picture%2B4.png 625w,\n/static/9e9c3620465f1b8c591011737a5ffb4a/5ee7d/4c52cd5c-365b-45d9-aa9e-ff3cd1af982c_Picture%2B4.png 833w,\n/static/9e9c3620465f1b8c591011737a5ffb4a/6a4a0/4c52cd5c-365b-45d9-aa9e-ff3cd1af982c_Picture%2B4.png 1200w","sizes":"(max-width: 417px) 100vw, 417px","presentationWidth":417}}}}}},{"__typename":"PrismicPostBodyImage","slice_type":"image","id":"Prismic__PostBodyImage__Prismic__Post__X4H6aBIAACIAIjDy__body__14","primary":{"image":{"localFile":{"id":"0a7bce4f-59e1-550b-8f80-dfca39d646cb","childImageSharp":{"id":"d1133171-a7d4-54d6-b4b7-cd289fd6d4e3","fluid":{"base64":"data:image/png;base64,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","aspectRatio":0.6403415154749199,"src":"/static/90fed75b70acd69a337905dbb6cf9f1a/92346/33046919-a60c-4528-afa5-5f5d8ea7c06c_Picture%2B5.png","srcSet":"/static/90fed75b70acd69a337905dbb6cf9f1a/5a635/33046919-a60c-4528-afa5-5f5d8ea7c06c_Picture%2B5.png 72w,\n/static/90fed75b70acd69a337905dbb6cf9f1a/ebbd7/33046919-a60c-4528-afa5-5f5d8ea7c06c_Picture%2B5.png 144w,\n/static/90fed75b70acd69a337905dbb6cf9f1a/92346/33046919-a60c-4528-afa5-5f5d8ea7c06c_Picture%2B5.png 288w,\n/static/90fed75b70acd69a337905dbb6cf9f1a/9c260/33046919-a60c-4528-afa5-5f5d8ea7c06c_Picture%2B5.png 432w,\n/static/90fed75b70acd69a337905dbb6cf9f1a/5ee7d/33046919-a60c-4528-afa5-5f5d8ea7c06c_Picture%2B5.png 576w,\n/static/90fed75b70acd69a337905dbb6cf9f1a/18a71/33046919-a60c-4528-afa5-5f5d8ea7c06c_Picture%2B5.png 1200w","sizes":"(max-width: 288px) 100vw, 288px","presentationWidth":288}}}}}},{"__typename":"PrismicPostBodyText","slice_type":"text","id":"Prismic__PostBodyText__Prismic__Post__X4H6aBIAACIAIjDy__body__15","primary":{"text":{"html":"<p>Как вы понимаете, количество комбинацией куча. Так что главная задача – сделать масштабируемо!</p><p>Вот так выглядит схема одного тайла в цветном и чёрно-белом варианте варианте:</p>"}}},{"__typename":"PrismicPostBodyImage","slice_type":"image","id":"Prismic__PostBodyImage__Prismic__Post__X4H6aBIAACIAIjDy__body__16","primary":{"image":{"localFile":{"id":"42de1ff0-ab88-51d7-953a-d9334d5407cd","childImageSharp":{"id":"e1933598-9b58-50c6-8ce5-9f345d876123","fluid":{"base64":"data:image/png;base64,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","aspectRatio":0.6853226727584237,"src":"/static/22786fe6d53160b3907214a785132d07/92346/4b0bbc7e-ebbd-445f-9d2a-c400eff80b6e_Picture%2B6.png","srcSet":"/static/22786fe6d53160b3907214a785132d07/5a635/4b0bbc7e-ebbd-445f-9d2a-c400eff80b6e_Picture%2B6.png 77w,\n/static/22786fe6d53160b3907214a785132d07/ebbd7/4b0bbc7e-ebbd-445f-9d2a-c400eff80b6e_Picture%2B6.png 154w,\n/static/22786fe6d53160b3907214a785132d07/92346/4b0bbc7e-ebbd-445f-9d2a-c400eff80b6e_Picture%2B6.png 308w,\n/static/22786fe6d53160b3907214a785132d07/9c260/4b0bbc7e-ebbd-445f-9d2a-c400eff80b6e_Picture%2B6.png 463w,\n/static/22786fe6d53160b3907214a785132d07/5ee7d/4b0bbc7e-ebbd-445f-9d2a-c400eff80b6e_Picture%2B6.png 617w,\n/static/22786fe6d53160b3907214a785132d07/7391a/4b0bbc7e-ebbd-445f-9d2a-c400eff80b6e_Picture%2B6.png 1200w","sizes":"(max-width: 308px) 100vw, 308px","presentationWidth":308}}}}}},{"__typename":"PrismicPostBodyImage","slice_type":"image","id":"Prismic__PostBodyImage__Prismic__Post__X4H6aBIAACIAIjDy__body__17","primary":{"image":{"localFile":{"id":"58e9941d-eb26-56d2-b120-d652a15d9f9f","childImageSharp":{"id":"a78ec7e0-9b0e-5b49-8693-f334a7bafab9","fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAIAAACjcKk8AAAACXBIWXMAAAsTAAALEwEAmpwYAAADfUlEQVQ4y4VVW3PSUBDml/sj1BcdH3UcxxkftA8w3AqUAoGQCzcpLQmUJJDQEpB7ufglXxqpreP3cGazZ3e/3T0neyJHH4fDAet0NtN7ujOyJ5OJpmu9nj6d3muaftPpOOPxxHV/zefHE0Toud/vIQwGg3pNEYTyeHyn93utel3TuplsLplMqDWl1WiMHAdmMCZZ5PgM2JhOp4vFYj6fu647XyzW6/XhEU+Yd7tdu92u+VBVtV6vV6tVWZZFUaxUKpDL5bIgCJCLxSIErJeXl1iHw2EEUTOZTD6fv7i4yGazhUIh6wMa6KnM5XJYz8/P8Zl5RL/f95yxh5ClUgme4Cn6gIDPkg/sUg/+UGOaZmS1WsG57APbyJbb/BQeEe5CqPjw0oYzkmFhp84QyM+CqUcLIFMZMKdSKdghSdQJC/QDQs4HI5IZBhCw0tgwDM85nU4zXpgYOQFQse1cJUmiJWBZVsB82jAItPNMKkEIADZh2kCQdjweZ51he9lPtg1C3keY1xNmpM3YJIQFHVLpFOpHO2GAc4aSlweA8RPnsJ9+XO94kqlkLBaLRqNYmUjYamThNWy5XCJtEmKDpYa9AVAL7xZygRuZofeY8QOAmfkgNqOwvTxhgqFpxhq9SwJnMNMTFdKUHWbDALLx2uJWUx8wh2nzMHglICBhcgKsIvzbgrRZM48XzAxBwvCoCBb15HqCGc1keKiwHTb29E9gh3mcf5jhnEgkkI9njf8BpfrOdBN9N55s2TtnttPrQuB8nk7X6wo4ZUFQZFmRRKlakaoSvGVFaTSbiiw1lKooyZKsyKoqKSoCmXDGKJq4s1qja1pmbeyOHLuh29f90Xh67ywXxmAgCiXDvq8NpnZfc4eGedMxu9erzQZD03PWzeGr1++QTOy6K1TFs3g+nSu3blpts5vN5N68fSNUm7GCcRH/IWQTqe9fo98+r9bbYHpa1u3Hz+9t2z5YLWdslWOFa7Wjd5pCKuqMhrdqYXg7OC43UqGU/PJdHCilq8p+uw+cbfP27NMHxxlfFeWRZbSbo57m2LZ51W6v5rON2cFjsD7srKuuIbfutnfu2j3sHuf2YvGrq//cbLaGPlku13/N8OMLkz2Y+y8N/f3hz4g/mfWew/7Z0O/1epqm4a3BGD7+GwyBG4mJDWO8JxE+LnhWsCLQ8X94eHiA5Ww2g/AbDzj3aR5U22UAAAAASUVORK5CYII=","aspectRatio":0.6741573033707865,"src":"/static/56bc997b64bef6d091763cfb1ed919ba/92346/fa75ca2c-6974-4bf7-a06a-d16d3040a7c5_Picture%2B7.png","srcSet":"/static/56bc997b64bef6d091763cfb1ed919ba/5a635/fa75ca2c-6974-4bf7-a06a-d16d3040a7c5_Picture%2B7.png 76w,\n/static/56bc997b64bef6d091763cfb1ed919ba/ebbd7/fa75ca2c-6974-4bf7-a06a-d16d3040a7c5_Picture%2B7.png 152w,\n/static/56bc997b64bef6d091763cfb1ed919ba/92346/fa75ca2c-6974-4bf7-a06a-d16d3040a7c5_Picture%2B7.png 303w,\n/static/56bc997b64bef6d091763cfb1ed919ba/9c260/fa75ca2c-6974-4bf7-a06a-d16d3040a7c5_Picture%2B7.png 455w,\n/static/56bc997b64bef6d091763cfb1ed919ba/5ee7d/fa75ca2c-6974-4bf7-a06a-d16d3040a7c5_Picture%2B7.png 607w,\n/static/56bc997b64bef6d091763cfb1ed919ba/4396b/fa75ca2c-6974-4bf7-a06a-d16d3040a7c5_Picture%2B7.png 1200w","sizes":"(max-width: 303px) 100vw, 303px","presentationWidth":303}}}}}},{"__typename":"PrismicPostBodyText","slice_type":"text","id":"Prismic__PostBodyText__Prismic__Post__X4H6aBIAACIAIjDy__body__18","primary":{"text":{"html":"<p>Не спрашивайте почему в таблице-статистике остались цвета, хотя PDF в черно-белом формате рассчитана для пользователей, у которых нет цветного принтера. Таково пожелание заказчика. Я вообще не понимаю, почему они сами распечатать не могут и положить в коробку вместе с LEGO, но это не моего ума дело. </p><h1>Вместо выводов и итогов</h1><p>Считаю, что получилось хорошо, но можно было лучше. Мне не совсем нравятся границы таблицы, выравнивание в таблице-статистике. Но я шатал эти размеры шрифтов высчитывать. </p><p>А ТЕПЕРЬ О САМОМ ВКУСНОМ, НО В ХАОТИЧНОМ ФОРМАТЕ.</p><p>Помните, я говорил про вектор? Дык я сделал, да, без проблем. Нашел библиотеку, что конверит svg в rlg (reportlab graphics object). Так и называется, <em>svg2rlg</em>. И всё бы ничего, но генерация на моем компьютере занимала больше минуты. Под две даже. ДВЕ минуты на генерацию PDF, карл! Я пытался оптимизировать, конечно же только один раз прогревал эти svg файлы конвертя в rlg, пытался оптимайзить, но узкое место и было как раз в использование этих объектов.</p><p>Как бы уже все смирились с тем, что столько будет генериться… Покажут проверку оплаты пользователю и ладно. Дошло дело до деплоя… Вся эта радость оказалась не на машине нормальной, человеческой, хотя тут <em>FastAPI</em> со всеми эндпоинтами, а, блин, на AWS лямбдах! И вызов функций через gateway! В обход всей валидации параметров, что дает <em>FastAPI</em>! Ну это ничего, подумал я, но стало чего тогда, когда я узнал, что gateway не держит timeout больше 30 секунд! Даже за тысячу долларов тебе не включат такую возможность. Пошел я сообщать печальную новость и предложил три варианта решения проблемы. </p><p>Я не бросил экспериментировать с оптимизацией и попробовал поработать с PNG и JPG. Вариант с PNG 1000x1000 не лучше SVG, а даже хуже, а вот с JPG отрабатывает за считанные секунды! Я был удивлен скорости! Генерация PDF с 2 минут упала до 3-4 секунд! Вы представляете? Я радуюсь тому, что запрос работает за секунды, когда мы все привыкли к мс! Только за счет того, что я не использовал png/svg, а взял jpg! Объяснил ситуацию, взяли 1000x1000 изображения, что дают хороший запас увеличения PDF без потери качества, запросил изображения с цветным фоном, так как это jpg и я не могу отрисовать фон сам в ячейке.</p><p>Короче, я сдал проект. </p>"}}}]}},"posts":{"nodes":[{"id":"Prismic__Post__Z3AWEBEAACQAq0KX","uid":"2024","data":{"title":{"text":"Итоги Года 2024"},"date":"28.12.2024","categories":[{"category":{"document":[{"id":"Prismic__Category__Y635ZxAAACQAwo9V","uid":"results-of-the-year","data":{"name":"Итоги Года"}}]}}]}},{"id":"Prismic__Post__ZYgWYhAAACYAKMp2","uid":"2023","data":{"title":{"text":"Итоги Года 2023"},"date":"31.12.2023","categories":[{"category":{"document":[{"id":"Prismic__Category__Y635ZxAAACQAwo9V","uid":"results-of-the-year","data":{"name":"Итоги Года"}}]}}]}},{"id":"Prismic__Post__Y62KDBAAACYAwfBO","uid":"2022","data":{"title":{"text":"Итоги Года 2022"},"date":"31.12.2022","categories":[{"category":{"document":[{"id":"Prismic__Category__Y635ZxAAACQAwo9V","uid":"results-of-the-year","data":{"name":"Итоги Года"}}]}}]}},{"id":"Prismic__Post__Y639RhAAACMAwpTU","uid":"2021","data":{"title":{"text":"Итоги Года 2021"},"date":"31.12.2021","categories":[{"category":{"document":[{"id":"Prismic__Category__Y635ZxAAACQAwo9V","uid":"results-of-the-year","data":{"name":"Итоги Года"}}]}}]}}]}},"pageContext":{"uid":"generaciya-shemy-sborki-kartiny-fotografii-iz-lego"}}}